# COOL Compiler #
A lexical analyzer for COOL programming language written in ANTLRv4 as part of CS 3320.
Author : @sowgali

## Body of Lexer ##
Important token names are listed and then some routines were defined.

### Routine 1 ###
processError : This routine handles the errors generated by lexer.

### Routine 2 ###
processString : This routine processes string constants:
  1. String ends in either **\n** or **"** or **EOF**.
  2. It checks the last character of string and sets flags accordingly.
  3. It starts scanning through the string and appends valid scanned characters to a buffer.
  4. In course of scanning if it finds an error character like null, unescaped newline, etc, it sets corresponding flags.
  5. It may unset the set flags if they are preceded by an unescaped backslash in which case they are actually escaped.
  6. A variable (**i**) is used to keep track of count beyond 1024, for null or unterminated characters.
  7. Finnaly errors are checked in order of precedence of *coolc*.
  8. Outputs for simulataneous errors are described in respective test cases.

### Routine 3 ###
processOthers : This routine processes all the other tokens encountered that are not specified by the grammar and returns them as an error.

### General Body of rules ###
  - First all the keywords like **class, else, false, fi, if, in, inherits, isvoid, let, loop, pool, then, while,
case, esac, new, of, not, true** are defined. They are case-insensitive.

  - Basic constants and some special names are defined:

    - 'self' , 'SELF_TYPE' are special names
    - First letter of "true" and "false" should be small and defined accordingly and hence : `[t][rR][uU][eE] | [f][aA][lL][sS][eE]`
    - First letter of _TYPEID_ must be in uppercase : `[A-Z][a-zA-Z0-9_]*` and that of *OBJECTID* must be lowercase : `[a-z][a-zA-Z0-9_]*`.
    - Integer constant comprises of atleast one digit : `[0-9]+`.
    - String constant is enclosed in **""** and it is handled in **STR_MODE** : `'"' -> skip,pushMode(STR_MODE);`

      - This mode contains only one rule, any string will have following structure:
      ``BODY				: (((~('\n'|'"'|'\\'))|'\\'(.)) ('\\''\n')?('\\''\"')?)* ('\n'|'"'|('\\'? EOF)) {processString();} -> popMode;``


  - All the symbolic lexical structures like **'{', '}', ':', '@', ',', '+', '-'** etc are defined.
  - All the whitespaces are ignored : ``[ \n\f\r\t\v]+	-> skip``.
  - Inline comment ignores that particular line : ``'--' (~('\n'))*? ('\n' | EOF) 	-> skip``.
  - Nesting comments are handled by **NEST_COMMENT** mode:

    - Calls **RECURSE** mode to handle recursive nesting.
    - If an **EOF** is encountered within a comment, reports it to *processError()* : ``.(EOF) {reportError("EOF in comment");}``.
    - If end of the comment is encountered, pops out from the the current mode : ``'*)' -> popMode , skip``.
    - Skips all the contents of comments : ``.			-> skip``.

    - The **RECURSE** mode handles the recursion in comments.
    - Main recursive step is : ``'(*'  -> pushMode(RECURSE) , skip``.
    - **EOF** s are also handled : ``.(EOF) {reportError("EOF in comment");}`` , ``'*)' EOF {reportError("EOF in comment");}``.
    - If an end of comment is encountered : ``'*)' -> popMode , skip;``.
    - Contents are ignored : ``.			-> skip;``.

  - All the other tokens than those specified by above lexical rules are handled by : ``.	{processOthers();}``.

## Note ##
Exact line number is handled but error message is logged correctly.

## Test Cases ##
  0. This test contains normal string, string with 1024 characters with escapes, an empty srting, string with multiple escaped new lines - all are valid strings, hence no errors
  1. Strings with basic errors:
    - Contains string with length > 1024 : `"String constant too long"`.
    - Contains string with null : `"String contains null character"`.
    - Contains string with escaped null : `"String contains escaped null"`.
    - Contains string with unescaped newlines : `"Unterminated string constant"`.
    - Contains a string with EOF : `"EOF in string constant"`.
  2. String with simultaneous errors:
    - 1024 + Null : `"String contains null character"`.
    - 1025 + Null : `"String contains null character"`.
    - 1026 + Null : `"String constant too long"`.
    - 1024 + unterminated : `"Unterminated string constant"`.
    - 1025 + unterminated : `"Unterminated string constant"`.
    - 1026 + unterminated : `"String constant too long"`.
  3. Contains a string with backslash at EOF : `"backslash at the end of file"`.
  4. **EOF** in comment.
  5. Unmatched end of comment.
  6. Invalid object name.
  7. Test cases 7 through 11 are some general codes without any errors.
